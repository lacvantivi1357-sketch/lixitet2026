<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>L√¨ X√¨ 30.0 - Precision & Economy</title>
    <style>
        /* --- NGUY√äN T·∫ÆC THI·∫æT K·∫æ: S·∫ÆC N√âT & T∆Ø∆†NG PH·∫¢N CAO --- */
        :root { 
            --red-main: #d32f2f; 
            --gold-main: #fbc02d; 
            --fever-color: #00e5ff; 
            --ice-color: #bbdefb; 
            --white-bg: #ffffff;
            --text-dark: #212121;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body { 
            margin: 0; padding: 0; overflow: hidden; 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background: #1a1a1a; touch-action: none; user-select: none; 
        }

        /* --- VISUAL FX: KH√îNG BLUR, KH√îNG RUNG L·∫ÆC --- */
        #iceFrame { 
            position: fixed; inset: 0; pointer-events: none; z-index: 100; 
            border: 20px solid rgba(187, 222, 251, 0.5); opacity: 0; transition: 0.4s; 
            box-shadow: inset 0 0 60px rgba(187, 222, 251, 0.3); 
        }

        .fever-active-glow { box-shadow: inset 0 0 100px rgba(0, 229, 255, 0.2); }

        /* --- KI·∫æN TR√öC M√ÄN H√åNH --- */
        .app-screen { 
            position: absolute; inset: 0; display: none; flex-direction: column; 
            align-items: center; justify-content: center; text-align: center; color: white; 
        }

        #menuScreen { 
            display: flex; 
            background: radial-gradient(circle at center, #ff5252 0%, #b71c1c 100%); 
            z-index: 10; 
        }

        #gameScreen { background: var(--white-bg); cursor: none; overflow: hidden; }

        /* --- HUD (GIAO DI·ªÜN CH·ªà S·ªê) --- */
        .hud-top-bar { 
            position: absolute; top: 0; width: 100%; height: 100px;
            display: flex; flex-direction: column; align-items: center; z-index: 50; 
            pointer-events: none;
        }

        .hud-stats {
            width: 100%; display: flex; justify-content: space-around; 
            padding: 20px 0; font-size: 2rem; font-weight: 900; 
            color: var(--red-main); text-shadow: 2px 2px 0 #fff;
        }

        .status-badge-tray { 
            display: flex; gap: 10px; font-size: 1.5rem; 
            background: rgba(255,255,255,0.85); padding: 5px 25px; 
            border-radius: 50px; border: 2px solid var(--red-main);
        }

        /* --- ENERGY ENGINE --- */
        .energy-track { 
            position: absolute; bottom: 30px; left: 10%; width: 80%; height: 18px; 
            background: rgba(0,0,0,0.1); border-radius: 20px; border: 3px solid var(--red-main); 
            overflow: hidden; z-index: 50; 
        }

        .energy-fill-bar { 
            width: 0%; height: 100%; background: linear-gradient(90deg, var(--fever-color), #fff); 
            transition: width 0.3s ease; 
        }

        /* --- GACHA BOX SYSTEM --- */
        .gacha-grid { 
            display: grid; grid-template-columns: repeat(3, 1fr); 
            gap: 20px; padding: 20px; 
        }

        .envelope-card { perspective: 1000px; width: 95px; height: 140px; cursor: pointer; }
        .envelope-inner { position: relative; width: 100%; height: 100%; transition: 0.8s; transform-style: preserve-3d; }
        .envelope-face { 
            position: absolute; inset: 0; backface-visibility: hidden; border-radius: 15px; 
            display: flex; align-items: center; justify-content: center; border: 4px solid var(--gold-main); 
        }
        .envelope-front { background: var(--red-main); font-size: 3.5rem; box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
        .envelope-back { background: white; color: var(--red-main); font-weight: 900; transform: rotateY(180deg); font-size: 1.4rem; }
        .flipped .envelope-inner { transform: rotateY(180deg); }

        /* --- BUTTONS --- */
        .btn-ui { 
            background: var(--gold-main); color: #7f0000; border: none; padding: 20px 60px; 
            border-radius: 100px; font-weight: 900; cursor: pointer; 
            box-shadow: 0 8px 0 #b79500; margin-top: 20px; font-size: 1.3rem; 
            text-transform: uppercase;
        }
        .btn-ui:active { transform: translateY(6px); box-shadow: none; }
        
        .admin-trigger-zone { position: fixed; top: 10px; right: 10px; opacity: 0.03; cursor: pointer; z-index: 1000; font-size: 25px; }

        /* --- ADMIN INTERFACE --- */
        .modal-wrap { 
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); 
            z-index: 2000; align-items: center; justify-content: center; 
        }

        .modal-body { 
            background: white; padding: 35px; border-radius: 25px; width: 95%; 
            max-width: 500px; color: var(--text-dark); max-height: 90vh; overflow-y: auto; 
        }

        .adm-input { width: 100%; padding: 15px; margin-bottom: 12px; border-radius: 10px; border: 1px solid #ccc; font-size: 1.1rem; }
        .adm-area { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 2px solid #f0f0f0; font-family: monospace; font-size: 0.95rem; }
        
        .stat-row { display: flex; justify-content: space-between; padding: 12px; background: #f5f5f5; border-radius: 10px; margin-bottom: 10px; border-left: 5px solid var(--gold-main); }
    </style>
</head>
<body>
    <div id="iceFrame"></div>
    
    <div id="menuScreen" class="app-screen">
        <div class="admin-trigger-zone" onclick="UIManager.openModal('loginModal')">‚öôÔ∏è</div>
        <div style="font-size: 7rem; margin-bottom: 10px;">üßß</div>
        <h1 style="margin:0; font-size: 3.8rem; text-shadow: 3px 3px 0 #7f0000;">L√å X√å 30.0</h1>
        <p style="font-size: 1.2rem; font-weight: 300; letter-spacing: 2px;">PRECISION & ECONOMY ‚Ä¢ HCMUTE IT</p>
        <button class="btn-ui" onclick="GameEngine.startup()">B·∫ÆT ƒê·∫¶U CH∆†I</button>
    </div>

    <div id="gameScreen" class="app-screen">
        <div class="hud-top-bar">
            <div class="hud-stats">
                <span>‚è≥ <span id="timeVal">60</span>s</span>
                <span>üí∞ <span id="scoreVal">0</span></span>
            </div>
            <div class="status-badge-tray" id="statusIcons"></div>
        </div>
        <canvas id="gameCanvas"></canvas>
        <div class="energy-track"><div class="energy-fill-bar" id="energyFill"></div></div>
    </div>

    <div id="pickScreen" class="app-screen">
        <h2 style="color:var(--gold-main); font-size: 2.5rem; margin: 0;">CH·ªåN V·∫¨N MAY</h2>
        <p style="margin-bottom: 25px; font-size: 1.2rem;">K·ªπ nƒÉng gi√∫p tƒÉng t·ª∑ l·ªá qu√† to: +<span id="luckBonus">0</span>%</p>
        <div class="gacha-grid" id="cardGrid"></div>
    </div>

    <div id="revealScreen" class="app-screen">
        <div style="background:white; color:var(--red-main); padding:50px; border-radius:40px; border:8px solid var(--gold-main); width:350px; box-shadow: 0 0 100px rgba(0,0,0,0.6);">
            <h2 style="margin:0; font-size: 1.8rem;">PH·∫¶N TH∆Ø·ªûNG</h2>
            <div style="font-size: 6rem; margin: 20px 0;">üéä</div>
            <div id="prizeAmount" style="font-size: 3.5rem; font-weight: 900;">0ƒë</div>
            <button class="btn-ui" onclick="location.reload()">K·∫æT TH√öC</button>
        </div>
    </div>

    <div id="loginModal" class="modal-wrap">
        <div class="modal-body" style="max-width: 400px;">
            <h3 style="text-align:center; margin-bottom: 25px;">üîê ADMIN ACCESS</h3>
            <input type="text" id="admU" class="adm-input" placeholder="User">
            <input type="password" id="admP" class="adm-input" placeholder="Pass">
            <button class="btn-ui" style="width:100%" onclick="AdminBridge.verify()">V√ÄO C√ÄI ƒê·∫∂T</button>
            <button class="btn-ui" style="width:100%; background:#eee; box-shadow:none; color:#666;" onclick="UIManager.closeModal('loginModal')">H·ª¶Y</button>
        </div>
    </div>

    <div id="adminPanel" class="modal-wrap">
        <div class="modal-body">
            <h3 style="margin-top:0; border-bottom: 4px solid var(--gold-main); padding-bottom: 10px;">üìä QU·∫¢N TR·ªä KINH T·∫æ</h3>
            
            <div id="statsDisplay"></div>

            <label><b>C·∫•u h√¨nh 10 m·ªánh gi√° (S·ªë ti·ªÅn : T·ªâ l·ªá):</b></label>
            <textarea id="cfgData" class="adm-area" rows="11"></textarea>
            
            <div style="margin-top: 15px;">
                <button class="btn-ui" style="width:100%" onclick="AdminBridge.saveConfig()">L∆ØU T·ª∂ L·ªÜ</button>
                <button class="btn-ui" style="width:100%; background:#f44336; color:white; font-size: 1rem;" onclick="AdminBridge.resetStats()">X√ìA D·ªÆ LI·ªÜU</button>
                <button class="btn-ui" style="width:100%; background:#999; color:white;" onclick="UIManager.closeModal('adminPanel')">ƒê√ìNG</button>
            </div>
        </div>
    </div>

<script>
/* ==========================================================================
   MODULE 1: DATA PERSISTENCE (L∆ØU TR·ªÆ & C√ÇN B·∫∞NG KINH T·∫æ)
   ========================================================================== */
const DataProvider = {
    cfgKey: 'lx30_cfg_p1', histKey: 'lx30_hist_p1',
    
    // T·ª∂ L·ªÜ V√ÄNG 10 M·ªÜNH GI√Å: √âp d·ªëc ƒë·ªÉ b·∫£o v·ªá v√≠ ti·ªÅn
    initialSetup: [
        {amt: 10000, wt: 250}, {amt: 20000, wt: 180}, {amt: 30000, wt: 120}, {amt: 40000, wt: 80},
        {amt: 50000, wt: 40}, {amt: 60000, wt: 20}, {amt: 70000, wt: 10}, {amt: 80000, wt: 5},
        {amt: 90000, wt: 2}, {amt: 100000, wt: 1}
    ],

    init() {
        if (!localStorage.getItem(this.cfgKey)) localStorage.setItem(this.cfgKey, JSON.stringify(this.initialSetup));
    },

    getConfig() { return JSON.parse(localStorage.getItem(this.cfgKey)); },
    saveConfig(d) { localStorage.setItem(this.cfgKey, JSON.stringify(d)); },
    
    getHistory() { return JSON.parse(localStorage.getItem(this.histKey)) || []; },
    logPrize(val) {
        let h = this.getHistory();
        h.push({ t: new Date().toLocaleString(), v: val });
        if (h.length > 500) h.shift();
        localStorage.setItem(this.histKey, JSON.stringify(h));
    }
};

/* ==========================================================================
   MODULE 2: AUDIO ENGINE (√ÇM THANH S·∫ÆC N√âT)
   ========================================================================== */
const AudioNode = {
    ctx: null,
    start() { if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
    beep(f, type = 'sine', d = 0.1, v = 0.05) {
        if (!this.ctx) return;
        if (this.ctx.state === 'suspended') this.ctx.resume();
        const o = this.ctx.createOscillator(), g = this.ctx.createGain();
        o.type = type; o.frequency.setValueAtTime(f, this.ctx.currentTime);
        g.gain.setValueAtTime(v, this.ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + d);
        o.connect(g); g.connect(this.ctx.destination);
        o.start(); o.stop(this.ctx.currentTime + d);
    },
    onCatch() { this.beep(1100, 'sine', 0.1); },
    onFever() { this.beep(600, 'square', 0.4, 0.08); setTimeout(()=>this.beep(900, 'square', 0.5, 0.08), 120); }
};

/* ==========================================================================
   MODULE 3: CORE GAME ENGINE (ƒê·ªòNG C∆† TR√í CH∆†I CH√çNH)
   ========================================================================== */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let W, H;

const GameEngine = {
    state: { active: false, score: 0, time: 60, items: [], particles: [] },
    actor: { x: 0, y: 0, w: 105, h: 90 },
    fever: { val: 0, active: false, timer: 0 },
    
    // TR·∫†NG TH√ÅI V·∫¨T PH·∫®M (KH√îNG M·ªú - CH·ªà LOGIC)
    status: { shield: false, frozen: 0, reverse: 0, magnet: 0, stun: 0, lag: 0, god: 0, blackhole: 0 },

    startup() {
        DataProvider.init(); AudioNode.start();
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
        
        this.actor.x = W / 2 - 52; this.actor.y = H - 150;
        this.state.active = true; this.state.score = 0; this.state.time = 60;
        this.state.items = []; this.state.particles = [];
        this.fever = { val: 0, active: false, timer: 0 };
        Object.keys(this.status).forEach(k => this.status[k] = (typeof this.status[k] === 'boolean' ? false : 0));

        UIManager.screenJump('gameScreen');
        document.getElementById('menuScreen').style.display = 'none';

        this.frameLoop();
        this.spawnLoop();
        this.timerLoop();
    },

    timerLoop() {
        const t = setInterval(() => {
            if (!this.state.active) return clearInterval(t);
            this.state.time--;
            document.getElementById('timeVal').innerText = this.state.time;

            Object.keys(this.status).forEach(k => { if (typeof this.status[k] === 'number' && this.status[k] > 0) this.status[k]--; });
            if (this.fever.active) { this.fever.timer--; if (this.fever.timer <= 0) this.fever.active = false; }

            UIManager.refreshFX();
            if (this.state.time <= 0) this.finish();
        }, 1000);
    },

    spawnLoop() {
        if (!this.state.active) return;

        // GI·ªöI H·∫†N V·∫¨T PH·∫®M: Tr√°nh "m∆∞a bao" g√¢y lo·∫°n m·∫Øt
        if (this.state.items.length < 15) {
            let r = Math.random(), type = 'coin';

            // PH√ÇN B·ªî TR·ªåNG S·ªê V·∫¨T PH·∫®M TRONG GAME
            if (r < 0.12) type = 'bomb';
            else if (r < 0.22) type = 'star';
            else if (r < 0.24) type = 'ice'; else if (r < 0.26) type = 'reverse';
            else if (r < 0.28) type = 'drunk'; else if (r < 0.29) type = 'stun';
            else if (r < 0.31) type = 'lag'; else if (r < 0.33) type = 'blackhole';
            else if (r < 0.35) type = 'shield'; else if (r < 0.37) type = 'magnet';

            if (this.fever.active) type = (Math.random() < 0.35) ? 'star' : 'coin';

            this.state.items.push({
                x: Math.random() * (W - 60), y: -80, type,
                spd: (4 + Math.random() * 2) * (1 + (60 - this.state.time) / 250),
                phase: Math.random() * Math.PI * 2
            });
        }

        let nextTick = this.fever.active ? 220 : Math.max(750, 1200 - (60 - this.state.time) * 6);
        setTimeout(() => this.spawnLoop(), nextTick);
    },

    frameLoop() {
        if (!this.state.active) return;
        ctx.clearRect(0, 0, W, H);

        // Particle System (S·∫Øc n√©t)
        for (let i = this.state.particles.length - 1; i >= 0; i--) {
            let p = this.state.particles[i];
            p.x += p.vx; p.y += p.vy; p.life -= 0.05;
            if (p.life <= 0) this.state.particles.splice(i, 1);
            else {
                ctx.fillStyle = `rgba(211, 47, 47, ${p.life})`;
                ctx.fillRect(p.x, p.y, 5, 5); // V·∫Ω h√¨nh vu√¥ng cho s·∫Øc n√©t
            }
        }

        // V·∫Ω Nh√¢n v·∫≠t
        let icon = this.fever.active ? "üòé" : (this.status.frozen > 0 ? "ü•∂" : (this.status.stun > 0 ? "üòµ" : "üß∫"));
        ctx.font = `110px Arial`;
        ctx.fillText(icon, this.actor.x, H - 60);

        // V·∫Ω V·∫≠t ph·∫©m
        for (let i = this.state.items.length - 1; i >= 0; i--) {
            let it = this.state.items[i];
            let isBad = ['bomb', 'ice', 'reverse', 'drunk', 'stun', 'lag', 'blackhole'].includes(it.type);

            if (it.type === 'blackhole') {
                it.y += it.spd;
                this.state.items.forEach(o => { 
                    if(o !== it) {
                        let d = Math.hypot(it.x - o.x, it.y - o.y);
                        if(d < 160) { o.x += (it.x - o.x)*0.1; o.y += (it.y - o.y)*0.1; }
                    }
                });
            } else if ((this.fever.active || this.status.magnet > 0) && !isBad) {
                it.x += (this.actor.x + 52 - it.x) * 0.15; it.y += (H - 100 - it.y) * 0.15;
            } else { it.y += it.spd; }

            ctx.font = `50px Arial`;
            const iconMap = { coin: 'üßß', bomb: 'üí£', star: 'üåü', ice: '‚ùÑÔ∏è', reverse: '‚ö°', drunk: 'ü§°', shield: 'üõ°Ô∏è', magnet: 'üß≤', blackhole: 'üï≥Ô∏è' };
            ctx.fillText(iconMap[it.type] || 'üßß', it.x, it.y);

            if (it.y > H - 140 && it.y < H - 50 && it.x > this.actor.x - 45 && it.x < this.actor.x + 105) {
                this.resolveHit(it.type, it.x, it.y); this.state.items.splice(i, 1);
            } else if (it.y > H) this.state.items.splice(i, 1);
        }

        document.getElementById('scoreVal').innerText = Math.floor(this.state.score);
        document.getElementById('energyFill').style.width = this.fever.active ? "100%" : this.fever.val + "%";
        requestAnimationFrame(() => this.frameLoop());
    },

    resolveHit(type, x, y) {
        let isBad = ['bomb', 'ice', 'reverse', 'drunk', 'stun', 'lag', 'blackhole'].includes(type);
        if (isBad && this.status.shield) { this.status.shield = false; return; }

        if (type === 'bomb') {
            this.state.score = Math.max(0, this.state.score - 10);
            this.fever.val = Math.max(0, this.fever.val - 45); 
        } else if (type === 'coin') {
            this.state.score += 1; AudioNode.onCatch();
        } else if (type === 'star') {
            if (!this.fever.active) {
                this.fever.val += 20;
                if (this.fever.val >= 100) { this.fever.active = true; this.fever.val = 0; this.fever.timer = 8; AudioNode.onFever(); }
            }
            AudioNode.onCatch();
        } else if (type === 'ice') this.status.frozen = 4;
        else if (type === 'reverse') this.status.reverse = 5;
        else if (type === 'drunk') this.status.lag = 4; // Chuy·ªÉn say r∆∞·ª£u th√†nh Lag ƒëi·ªÅu khi·ªÉn
        else if (type === 'stun') this.status.stun = 1.5;
        else if (type === 'shield') this.status.shield = true;
        else if (type === 'magnet') this.status.magnet = 6;

        // T·∫°o h·∫°t s·∫Øc n√©t (kh√¥ng nh√≤e)
        for (let i = 0; i < 6; i++) {
            this.state.particles.push({ x, y, vx: Math.random() * 8 - 4, vy: Math.random() * 8 - 4, life: 1 });
        }
        if (navigator.vibrate) navigator.vibrate(40);
    },

    finish() {
        this.state.active = false;
        UIManager.screenJump('pickScreen');
        // KINH T·∫æ: Luck t·ªëi ƒëa 30%
        let luck = Math.min(30, this.state.score / 20);
        document.getElementById('luckBonus').innerText = Math.floor(luck);
        GachaMaster.prepare(luck);
    }
};

/* ==========================================================================
   MODULE 4: GACHA SYSTEM (TO√ÅN H·ªåC C√ÇN B·∫∞NG TR·ª∞C TI·∫æP)
   ========================================================================== */
const GachaMaster = {
    prepare(luck) {
        const grid = document.getElementById('cardGrid');
        grid.innerHTML = '';
        for (let i = 0; i < 9; i++) {
            const card = document.createElement('div');
            card.className = 'envelope-card';
            card.innerHTML = `<div class="envelope-inner"><div class="envelope-face envelope-front">üßß</div><div class="envelope-face envelope-back">?</div></div>`;
            card.onclick = () => this.draw(card, luck);
            grid.appendChild(card);
        }
        //
        window.onkeydown = (e) => { if (e.key === '9') window.forceMode = 'MAX'; if (e.key === '1') window.forceMode = 'MIN'; };
    },

    draw(el, luck) {
        if (el.classList.contains('flipped')) return;

        const cfg = DataProvider.getConfig();
        let prize = 10000;

        if (window.forceMode === 'MAX') prize = Math.max(...cfg.map(c => c.amt));
        else if (window.forceMode === 'MIN') prize = Math.min(...cfg.map(c => c.amt));
        else {
            let totalW = 0;
            // THU·∫¨T TO√ÅN FLOOR PROTECTION 60%
            const pool = cfg.map(item => {
                let w = item.wt;
                if (item.amt >= 50000) w *= (1 + luck / 15); 
                else w = Math.max(w * 0.6, w * (1 - luck / 100)); // Gi·∫£i nh·ªè lu√¥n chi·∫øm √≠t nh·∫•t 60% tr·ªçng s·ªë
                totalW += w;
                return { a: item.amt, cur: totalW };
            });
            const roll = Math.random() * totalW;
            prize = pool.find(p => roll <= p.cur).a;
        }

        el.classList.add('flipped');
        el.querySelector('.envelope-back').innerText = (prize / 1000) + 'k';
        
        setTimeout(() => {
            UIManager.screenJump('revealScreen');
            document.getElementById('prizeAmount').innerText = prize.toLocaleString() + 'ƒë';
            DataProvider.logPrize(prize);
        }, 1200);
    }
};

/* ==========================================================================
   MODULE 5: UI & ADMIN
   ========================================================================== */
const AdminBridge = {
    verify() {
        const u = document.getElementById('admU').value;
        const p = document.getElementById('admP').value;
        if (u === 'Admin' && p === 'Quoc2007@') { //
            UIManager.closeModal('loginModal');
            this.show();
        } else alert('Sai Pass!');
    },

    show() {
        UIManager.openModal('adminPanel');
        const cfg = DataProvider.getConfig();
        document.getElementById('cfgData').value = cfg.map(c => `${c.amt}:${c.wt}`).join('\n');
        
        const hist = DataProvider.getHistory();
        const sum = hist.reduce((a, b) => a + b.v, 0);
        document.getElementById('statsDisplay').innerHTML = `
            <div class="stat-row"><span>T·ªïng ti·ªÅn ph√°t:</span><b style="color:red">${sum.toLocaleString()}ƒë</b></div>
            <div class="stat-row"><span>T·ªïng l∆∞·ª£t ch∆°i:</span><b>${hist.length}</b></div>
        `;
    },

    saveConfig() {
        try {
            const raw = document.getElementById('cfgData').value.trim();
            const data = raw.split('\n').map(l => { const [a, w] = l.split(':'); return { amt: parseInt(a), wt: parseInt(w) }; });
            DataProvider.saveConfig(data); alert('Ok!');
        } catch(e) { alert('L·ªói ƒë·ªãnh d·∫°ng!'); }
    },

    resetStats() { if (confirm('X√≥a s·∫°ch?')) { localStorage.removeItem(DataProvider.histKey); this.show(); } }
};

const UIManager = {
    openModal: (id) => document.getElementById(id).style.display = 'flex',
    closeModal: (id) => document.getElementById(id).style.display = 'none',
    screenJump: (target) => { ['menuScreen', 'gameScreen', 'pickScreen', 'revealScreen'].forEach(s => document.getElementById(s).style.display = (s === target ? 'flex' : 'none')); },
    
    refreshFX() {
        document.getElementById('iceFrame').style.opacity = GameEngine.status.frozen > 0 ? 0.8 : 0;
        if (GameEngine.fever.active) document.getElementById('gameScreen').classList.add('fever-active-glow'); else document.getElementById('gameScreen').classList.remove('fever-active-glow');

        let i = "";
        if (GameEngine.status.shield) i += "üõ°Ô∏è ";
        if (GameEngine.status.magnet > 0) i += "üß≤ ";
        if (GameEngine.status.reverse > 0) i += "‚ö° ";
        document.getElementById('statusIcons').innerText = i;
    }
};

/* --- INPUT HANDLING --- */
const inputAction = (x) => {
    if (!GameEngine.state.active || GameEngine.status.stun > 0) return;
    let target = x - 52;
    if (GameEngine.status.reverse > 0) target = W - x - 52;
    const speed = GameEngine.status.frozen > 0 ? 0.16 : (GameEngine.status.lag > 0 ? 0.04 : 1);
    GameEngine.actor.x += (target - GameEngine.actor.x) * speed;
};

canvas.addEventListener('mousemove', e => inputAction(e.clientX));
canvas.addEventListener('touchmove', e => { e.preventDefault(); inputAction(e.touches[0].clientX); }, { passive: false });
window.onresize = () => { if (GameEngine.state.active) GameEngine.startup(); };
</script>
</body>
</html>
