<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>L√¨ X√¨ 50.0 - Titan Engine (HCMUTE Edition)</title>
<style>
    /* =========================================
       1. GLOBAL STYLES & VARIABLES
       ========================================= */
    :root {
        --c-red: #d0021b;
        --c-gold: #f5a623;
        --c-dark: #101010;
        --c-light: #ffffff;
        --c-panel: rgba(255, 255, 255, 0.95);
        --font-stack: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

    body, html {
        margin: 0; padding: 0; width: 100%; height: 100%;
        overflow: hidden; background-color: var(--c-dark);
        font-family: var(--font-stack);
    }

    /* --- CANVAS LAYER --- */
    canvas { display: block; width: 100%; height: 100%; }

    /* --- UI LAYERS --- */
    .ui-layer {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; display: flex; flex-direction: column;
        justify-content: center; align-items: center; z-index: 10;
    }

    .interactive { pointer-events: auto; }

    /* --- HUD --- */
    #hud {
        position: absolute; top: 0; left: 0; width: 100%; height: 100px;
        display: flex; justify-content: space-between; padding: 20px 30px;
        z-index: 20; display: none;
    }
    .hud-box {
        background: rgba(255, 255, 255, 0.9);
        border: 3px solid var(--c-red);
        border-radius: 12px; padding: 10px 25px;
        font-size: 1.5rem; font-weight: 900; color: var(--c-red);
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        display: flex; align-items: center; gap: 10px;
    }

    /* --- MENUS --- */
    .menu-panel {
        background: var(--c-panel);
        border-radius: 20px; padding: 40px; text-align: center;
        box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        border: 4px solid var(--c-gold);
        max-width: 400px; width: 90%;
        animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .title {
        font-size: 3.5rem; color: var(--c-red); margin: 0 0 10px 0;
        text-transform: uppercase; letter-spacing: 2px;
        text-shadow: 2px 2px 0px var(--c-gold);
    }

    .subtitle { color: #555; margin-bottom: 30px; font-weight: 500; }

    /* --- BUTTONS --- */
    .btn {
        background: var(--c-red); color: white; border: none;
        padding: 15px 40px; border-radius: 50px; font-size: 1.2rem;
        font-weight: 800; cursor: pointer; transition: transform 0.1s, background 0.2s;
        box-shadow: 0 5px 0 #900000; text-transform: uppercase; width: 100%;
        margin-bottom: 10px;
    }
    .btn:active { transform: translateY(4px); box-shadow: none; }
    .btn-gold { background: var(--c-gold); color: #8a5a00; box-shadow: 0 5px 0 #b37400; }
    .btn-gold:hover { background: #ffbf40; }

    /* --- GACHA GRID --- */
    .gacha-grid {
        display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px;
    }
    .card {
        aspect-ratio: 2/3; background: var(--c-red);
        border: 3px solid var(--c-gold); border-radius: 8px;
        cursor: pointer; position: relative; transition: transform 0.3s;
        transform-style: preserve-3d;
    }
    .card.flipped { transform: rotateY(180deg); background: white; }
    .card-face {
        position: absolute; inset: 0; display: flex;
        justify-content: center; align-items: center;
        backface-visibility: hidden; font-size: 2rem; font-weight: bold; color: var(--c-gold);
    }
    .card-back { transform: rotateY(180deg); color: var(--c-red); font-size: 1.2rem; }

    /* --- UTILS --- */
    .hidden { display: none !important; }
    @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    
    /* --- ADMIN & DEBUG --- */
    #debug-panel {
        position: fixed; bottom: 10px; right: 10px;
        background: rgba(0,0,0,0.8); color: lime;
        font-family: monospace; padding: 10px;
        border-radius: 5px; font-size: 10px;
        pointer-events: none; z-index: 999;
    }
    .admin-trigger { position: fixed; top: 10px; right: 10px; width: 30px; height: 30px; z-index: 1000; cursor: pointer; opacity: 0.1; }
    
    /* Admin Modal Specifics */
    textarea.code-editor {
        width: 100%; height: 150px; background: #222; color: #eee;
        border: 1px solid #444; padding: 10px; font-family: monospace; margin: 10px 0;
    }
</style>
</head>
<body>

    <canvas id="mainCanvas"></canvas>

    <div id="ui-layer" class="ui-layer">
        
        <div id="menu-panel" class="menu-panel interactive">
            <h1 class="title">L√¨ X√¨ 50.0</h1>
            <div class="subtitle">TITAN ENGINE ‚Ä¢ PROCEDURAL GRAPHICS</div>
            <button class="btn btn-gold" onclick="Engine.start()">KH·ªûI ƒê·ªòNG</button>
            <button class="btn" style="background:#333; margin-top:10px; font-size:0.9rem;" onclick="UI.toggleAdmin()">C·∫§U H√åNH H·ªÜ TH·ªêNG</button>
        </div>

        <div id="hud" class="interactive">
            <div class="hud-box">
                <span style="font-size:1.2rem">‚è≥</span> <span id="ui-time">60</span>
            </div>
            <div class="hud-box">
                <span style="font-size:1.2rem">üíé</span> <span id="ui-score">0</span>
            </div>
        </div>

        <div id="gacha-panel" class="menu-panel interactive hidden">
            <h2 style="color:var(--c-gold); margin:0;">V·∫¨N M·ªÜNH</h2>
            <p>Luck Bonus: +<span id="ui-luck">0</span>%</p>
            <div class="gacha-grid" id="card-grid"></div>
        </div>

        <div id="result-panel" class="menu-panel interactive hidden">
            <h2 style="margin:0; color:var(--c-red)">T·ªîNG K·∫æT</h2>
            <div style="font-size:4rem; margin:20px 0;">üéâ</div>
            <div id="final-prize" style="font-size:2.5rem; font-weight:900; color:var(--c-dark)">0 VNƒê</div>
            <button class="btn btn-gold" onclick="location.reload()">L∆ØU D·ªÆ LI·ªÜU</button>
        </div>

        <div id="admin-panel" class="menu-panel interactive hidden" style="max-width:500px;">
            <h3>SYSTEM KERNEL</h3>
            <div id="admin-stats" style="font-size:0.8rem; text-align:left; color:#666; margin-bottom:10px;"></div>
            <label style="display:block; text-align:left; font-weight:bold;">Probability Matrix (JSON):</label>
            <textarea id="admin-cfg" class="code-editor"></textarea>
            <button class="btn" onclick="Admin.save()">INJECT CONFIG</button>
            <button class="btn" style="background:#555" onclick="UI.toggleAdmin()">ABORT</button>
        </div>

    </div>

    <div id="debug-panel">FPS: 60 | ENTITIES: 0</div>

<script>
/**
 * ============================================================================
 * L√å X√å 50.0 - THE TITAN ENGINE
 * Architecture: Component-Entity-System (Lite)
 * Author: HCMUTE IT Student
 * ============================================================================
 */

/* --------------------------------------------------------------------------
   CORE MATH & UTILITIES (VECTOR2D)
   -------------------------------------------------------------------------- */
class Vec2 {
    constructor(x = 0, y = 0) { this.x = x; this.y = y; }
    add(v) { this.x += v.x; this.y += v.y; return this; }
    sub(v) { this.x -= v.x; this.y -= v.y; return this; }
    mult(n) { this.x *= n; this.y *= n; return this; }
    mag() { return Math.sqrt(this.x*this.x + this.y*this.y); }
    dist(v) { return Math.sqrt((this.x-v.x)**2 + (this.y-v.y)**2); }
    copy() { return new Vec2(this.x, this.y); }
    static random(min, max) { return new Vec2(Math.random()*(max-min)+min, Math.random()*(max-min)+min); }
}

const Utils = {
    rand: (min, max) => Math.random() * (max - min) + min,
    clamp: (val, min, max) => Math.max(min, Math.min(max, val)),
    lerp: (a, b, t) => a + (b - a) * t
};

/* --------------------------------------------------------------------------
   AUDIO SYNTHESIZER (NO EXTERNAL FILES)
   -------------------------------------------------------------------------- */
const AudioCore = {
    ctx: null,
    masterGain: null,
    
    init() {
        if (this.ctx) return;
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        this.ctx = new AudioContext();
        this.masterGain = this.ctx.createGain();
        this.masterGain.gain.value = 0.3; // Master volume
        this.masterGain.connect(this.ctx.destination);
    },

    playTone(freq, type, duration, vol = 1) {
        if (!this.ctx) return;
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        
        // Envelope: ADSR (Simplified)
        gain.gain.setValueAtTime(0, this.ctx.currentTime);
        gain.gain.linearRampToValueAtTime(vol, this.ctx.currentTime + 0.05); // Attack
        gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration); // Decay
        
        osc.connect(gain);
        gain.connect(this.masterGain);
        
        osc.start();
        osc.stop(this.ctx.currentTime + duration);
    },

    // Sound Presets
    sfx: {
        coin: () => {
            AudioCore.playTone(1200, 'sine', 0.1);
            setTimeout(() => AudioCore.playTone(1800, 'sine', 0.2), 50);
        },
        bomb: () => {
            AudioCore.playTone(100, 'sawtooth', 0.4, 0.5);
            AudioCore.playTone(50, 'square', 0.4, 0.5);
        },
        star: () => {
            AudioCore.playTone(600, 'triangle', 0.1);
            setTimeout(() => AudioCore.playTone(900, 'triangle', 0.1), 100);
            setTimeout(() => AudioCore.playTone(1200, 'triangle', 0.2), 200);
        },
        ui: () => AudioCore.playTone(800, 'sine', 0.05, 0.2)
    }
};

/* --------------------------------------------------------------------------
   PROCEDURAL GRAPHICS RENDERER (V·∫º B·∫∞NG CODE)
   -------------------------------------------------------------------------- */
const Graphics = {
    // V·∫Ω Bao L√¨ X√¨ (Vector)
    drawEnvelope(ctx, x, y, size) {
        const w = size; const h = size * 1.4;
        ctx.save();
        ctx.translate(x, y);
        
        // Body
        ctx.fillStyle = "#d0021b";
        ctx.beginPath();
        ctx.roundRect(-w/2, -h/2, w, h, 8);
        ctx.fill();
        ctx.lineWidth = 2; ctx.strokeStyle = "#f5a623"; ctx.stroke();

        // Flap (N·∫Øp bao)
        ctx.beginPath();
        ctx.moveTo(-w/2, -h/2 + 20);
        ctx.quadraticCurveTo(0, 0, w/2, -h/2 + 20);
        ctx.strokeStyle = "#ffcc00"; ctx.stroke();

        // Gold Circle
        ctx.fillStyle = "#f5a623";
        ctx.beginPath(); ctx.arc(0, -h/6, w/6, 0, Math.PI*2); ctx.fill();
        
        // Text "L·ªòC" (Procedural Text)
        ctx.fillStyle = "#d0021b"; ctx.font = `bold ${size/3}px Arial`;
        ctx.textAlign = "center"; ctx.textBaseline = "middle";
        ctx.fillText("üßß", 0, -h/6 + 2);

        ctx.restore();
    },

    // V·∫Ω ƒê·ªìng Ti·ªÅn (Vector)
    drawCoin(ctx, x, y, size) {
        ctx.save();
        ctx.translate(x, y);
        // Outer
        ctx.beginPath(); ctx.arc(0, 0, size/2, 0, Math.PI*2);
        ctx.fillStyle = "#ffd700"; ctx.fill();
        ctx.strokeStyle = "#daa520"; ctx.lineWidth = 2; ctx.stroke();
        // Inner Square
        ctx.fillStyle = "#e59400";
        ctx.fillRect(-size/6, -size/6, size/3, size/3);
        ctx.restore();
    },

    // V·∫Ω Bom (Vector)
    drawBomb(ctx, x, y, size) {
        ctx.save();
        ctx.translate(x, y);
        // Body
        ctx.beginPath(); ctx.arc(0, 5, size/2, 0, Math.PI*2);
        ctx.fillStyle = "#333"; ctx.fill();
        // Fuse
        ctx.beginPath(); ctx.moveTo(0, -size/2); ctx.quadraticCurveTo(5, -size, 10, -size/2 - 5);
        ctx.strokeStyle = "#fff"; ctx.lineWidth = 2; ctx.stroke();
        // Spark
        ctx.fillStyle = "#f00"; ctx.beginPath(); ctx.arc(10, -size/2 - 5, 3, 0, Math.PI*2); ctx.fill();
        // Skull Icon (Simple dots)
        ctx.fillStyle = "#fff";
        ctx.beginPath(); ctx.arc(-5, 5, 3, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(5, 5, 3, 0, Math.PI*2); ctx.fill();
        ctx.restore();
    },

    // V·∫Ω Gi·ªè H·ª©ng (Player)
    drawBasket(ctx, x, y, w, h) {
        ctx.save();
        ctx.translate(x, y);
        // Basket body
        ctx.fillStyle = "#8d6e63";
        ctx.beginPath();
        ctx.moveTo(-w/2, -h/2);
        ctx.lineTo(w/2, -h/2);
        ctx.lineTo(w/3, h/2);
        ctx.lineTo(-w/3, h/2);
        ctx.closePath();
        ctx.fill();
        // Weave pattern lines
        ctx.strokeStyle = "#5d4037"; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.moveTo(-w/2, -h/6); ctx.lineTo(w/2, -h/6); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(-w/2.5, h/6); ctx.lineTo(w/2.5, h/6); ctx.stroke();
        ctx.restore();
    }
};

/* --------------------------------------------------------------------------
   GAME LOGIC: ENTITIES & PHYSICS
   -------------------------------------------------------------------------- */
class Particle {
    constructor(x, y, color) {
        this.pos = new Vec2(x, y);
        this.vel = Vec2.random(-3, 3);
        this.life = 1.0;
        this.decay = Utils.rand(0.02, 0.05);
        this.color = color;
        this.size = Utils.rand(3, 6);
    }
    update() {
        this.pos.add(this.vel);
        this.vel.y += 0.1; // Gravity
        this.life -= this.decay;
    }
    draw(ctx) {
        if(this.life <= 0) return;
        ctx.globalAlpha = this.life;
        ctx.fillStyle = this.color;
        ctx.beginPath(); ctx.arc(this.pos.x, this.pos.y, this.size, 0, Math.PI*2); ctx.fill();
        ctx.globalAlpha = 1;
    }
}

class FallingItem {
    constructor(w, h) {
        this.pos = new Vec2(Utils.rand(20, w-20), -50);
        this.vel = new Vec2(0, Utils.rand(3, 6));
        this.type = Math.random(); 
        // 0-0.2: Bomb, 0.2-0.8: Coin, 0.8-1.0: Envelope
        this.size = 50;
        this.angle = 0;
        this.rotSpeed = Utils.rand(-0.05, 0.05);
        this.dead = false;
    }
    update(dt) {
        this.pos.add(this.vel);
        this.angle += this.rotSpeed;
        if (this.pos.y > window.innerHeight + 50) this.dead = true;
    }
    draw(ctx) {
        ctx.save();
        ctx.translate(this.pos.x, this.pos.y);
        ctx.rotate(this.angle);
        if (this.type < 0.2) Graphics.drawBomb(ctx, 0, 0, this.size);
        else if (this.type < 0.8) Graphics.drawCoin(ctx, 0, 0, this.size);
        else Graphics.drawEnvelope(ctx, 0, 0, this.size);
        ctx.restore();
    }
}

/* --------------------------------------------------------------------------
   ENGINE CORE: STATE MACHINE
   -------------------------------------------------------------------------- */
const Engine = {
    canvas: null,
    ctx: null,
    width: 0, height: 0,
    running: false,
    
    player: { pos: new Vec2(0,0), w: 100, h: 60, score: 0 },
    items: [],
    particles: [],
    
    timeLeft: 60,
    lastTime: 0,
    
    // Config Data (Injectable)
    config: {
        spawnRate: 600,
        gachaTable: [
            {v:10000, w:250}, {v:20000, w:180}, {v:30000, w:120}, 
            {v:40000, w:70}, {v:50000, w:40}, {v:100000, w:1}
        ]
    },

    init() {
        this.canvas = document.getElementById('mainCanvas');
        this.ctx = this.canvas.getContext('2d', { alpha: false }); // Optimize
        this.resize();
        window.addEventListener('resize', () => this.resize());
        
        // Input Handling (Pointer Lock concept without locking)
        this.canvas.addEventListener('mousemove', e => this.handleInput(e.clientX));
        this.canvas.addEventListener('touchmove', e => { e.preventDefault(); this.handleInput(e.touches[0].clientX); }, {passive:false});
        
        Data.load(); // Load data from storage
    },

    resize() {
        this.width = this.canvas.width = window.innerWidth;
        this.height = this.canvas.height = window.innerHeight;
        this.player.pos.y = this.height - 100;
        this.player.pos.x = this.width / 2;
    },

    start() {
        AudioCore.init();
        AudioCore.playTone(440, 'sine', 0.1);
        
        this.running = true;
        this.score = 0;
        this.time = 60;
        this.items = [];
        this.particles = [];
        
        UI.showScreen('gameScreen');
        this.lastTime = performance.now();
        this.loop(this.lastTime);
        this.spawnLoop();
        this.timerLoop();
    },

    handleInput(x) {
        if (!this.running) return;
        this.player.pos.x = Utils.clamp(x, this.player.w/2, this.width - this.player.w/2);
    },

    spawnLoop() {
        if (!this.running) return;
        this.items.push(new FallingItem(this.width, this.height));
        setTimeout(() => this.spawnLoop(), this.config.spawnRate);
    },

    timerLoop() {
        const t = setInterval(() => {
            if (!this.running) { clearInterval(t); return; }
            this.time--;
            document.getElementById('ui-time').innerText = this.time;
            if (this.time <= 0) this.gameOver();
        }, 1000);
    },

    loop(timestamp) {
        if (!this.running) return;
        const dt = (timestamp - this.lastTime) / 1000;
        this.lastTime = timestamp;

        // --- UPDATE ---
        // Update Items
        for (let i = this.items.length - 1; i >= 0; i--) {
            const it = this.items[i];
            it.update(dt);
            
            // AABB Collision Detection
            if (Math.abs(it.pos.x - this.player.pos.x) < (this.player.w/2 + it.size/2) &&
                Math.abs(it.pos.y - this.player.pos.y) < (this.player.h/2 + it.size/2)) {
                
                this.handleCollision(it);
                it.dead = true;
            }
            
            if (it.dead) this.items.splice(i, 1);
        }

        // Update Particles
        for (let i = this.particles.length - 1; i >= 0; i--) {
            const p = this.particles[i];
            p.update();
            if (p.life <= 0) this.particles.splice(i, 1);
        }

        // --- RENDER ---
        this.ctx.fillStyle = "#fff";
        this.ctx.fillRect(0, 0, this.width, this.height);
        
        // Grid background procedural
        this.ctx.strokeStyle = "#eee"; this.ctx.lineWidth = 1;
        this.ctx.beginPath();
        for(let x=0; x<this.width; x+=40) { this.ctx.moveTo(x,0); this.ctx.lineTo(x,this.height); }
        for(let y=0; y<this.height; y+=40) { this.ctx.moveTo(0,y); this.ctx.lineTo(this.width,y); }
        this.ctx.stroke();

        // Draw Player
        Graphics.drawBasket(this.ctx, this.player.pos.x, this.player.pos.y, this.player.w, this.player.h);

        // Draw Items
        this.items.forEach(it => it.draw(this.ctx));

        // Draw Particles
        this.particles.forEach(p => p.draw(this.ctx));

        // Debug Info
        document.getElementById('debug-panel').innerText = `FPS: ${Math.round(1/dt)} | ENT: ${this.items.length}`;

        requestAnimationFrame((t) => this.loop(t));
    },

    handleCollision(item) {
        // Spawn Particles
        for(let i=0; i<8; i++) {
            this.particles.push(new Particle(item.pos.x, item.pos.y, item.type < 0.2 ? '#333' : '#f5a623'));
        }

        if (item.type < 0.2) {
            // Bomb
            this.score = Math.max(0, this.score - 5);
            AudioCore.sfx.bomb();
            if (navigator.vibrate) navigator.vibrate(200);
        } else {
            // Good Item
            this.score += (item.type > 0.8) ? 3 : 1;
            AudioCore.sfx.coin();
        }
        document.getElementById('ui-score').innerText = this.score;
    },

    gameOver() {
        this.running = false;
        UI.showScreen('gacha-panel');
        // Luck Algo: Cap at 30%
        let luck = Math.min(30, Math.floor(this.score / 5));
        document.getElementById('ui-luck').innerText = luck;
        Gacha.init(luck);
    }
};

/* --------------------------------------------------------------------------
   DATA & ADMIN SYSTEM
   -------------------------------------------------------------------------- */
const Data = {
    keyCfg: 'titan_cfg', keyHist: 'titan_hist',
    load() {
        const s = localStorage.getItem(this.keyCfg);
        if (s) Engine.config.gachaTable = JSON.parse(s);
    },
    save(cfg) {
        localStorage.setItem(this.keyCfg, JSON.stringify(cfg));
        Engine.config.gachaTable = cfg;
    },
    logHistory(val) {
        let h = JSON.parse(localStorage.getItem(this.keyHist) || "[]");
        h.push({d: new Date().toLocaleString(), v: val});
        localStorage.setItem(this.keyHist, JSON.stringify(h.slice(-100)));
    }
};

const Admin = {
    login() {
        const u = document.getElementById('admU').value.trim();
        const p = document.getElementById('admP').value.trim();
        if(u === 'Admin' && p === 'Quoc2007@') {
            UI.toggleModal('login', false);
            UI.toggleAdmin(true);
        } else alert("ACCESS DENIED");
    },
    save() {
        try {
            const d = JSON.parse(document.getElementById('admin-cfg').value);
            Data.save(d); alert("SYSTEM UPDATED");
        } catch(e) { alert("SYNTAX ERROR"); }
    }
};

/* --------------------------------------------------------------------------
   GACHA & UI LOGIC
   -------------------------------------------------------------------------- */
const Gacha = {
    init(luck) {
        const grid = document.getElementById('card-grid');
        grid.innerHTML = '';
        for(let i=0; i<9; i++) {
            const c = document.createElement('div');
            c.className = 'card';
            c.innerHTML = `<div class="card-face">üßß</div><div class="card-face card-back">?</div>`;
            c.onclick = () => this.roll(c, luck);
            grid.appendChild(c);
        }
        // Cheat codes
        window.onkeydown = e => { if(e.key=='9') this.cheat='MAX'; if(e.key=='1') this.cheat='MIN'; };
    },
    roll(el, luck) {
        if(el.classList.contains('flipped')) return;
        
        const table = Engine.config.gachaTable;
        let prize = 10000;

        if(this.cheat === 'MAX') prize = Math.max(...table.map(i=>i.v));
        else if(this.cheat === 'MIN') prize = Math.min(...table.map(i=>i.v));
        else {
            // Weighted Random with Luck Factor (Floor 60%)
            let totalW = 0;
            const pool = table.map(i => {
                let w = i.w;
                if(i.v >= 50000) w *= (1 + luck/20); // Boost high prize
                else w = Math.max(w * 0.6, w * (1 - luck/100)); // Protect low prize
                totalW += w;
                return {v: i.v, cw: totalW};
            });
            const r = Math.random() * totalW;
            prize = pool.find(i => r <= i.cw).v;
        }

        el.classList.add('flipped');
        el.querySelector('.card-back').innerText = (prize/1000) + 'k';
        
        setTimeout(() => {
            UI.showScreen('result-panel');
            document.getElementById('final-prize').innerText = prize.toLocaleString() + ' VNƒê';
            Data.logHistory(prize);
        }, 1000);
    }
};

const UI = {
    showScreen(id) {
        document.querySelectorAll('.menu-panel, #hud').forEach(el => el.classList.add('hidden'));
        document.getElementById('menuScreen').style.display = 'none';
        
        if (id === 'gameScreen') {
            document.getElementById('hud').classList.remove('hidden');
            document.getElementById('hud').style.display = 'flex';
        } else {
            document.getElementById(id).classList.remove('hidden');
            // Show overlay background for modals
            if (id !== 'gameScreen') document.getElementById('ui-layer').style.background = "rgba(0,0,0,0.8)";
        }
    },
    toggleModal(name, show) {
        const el = document.getElementById(name+'Modal');
        el.style.display = show ? 'flex' : 'none';
    },
    toggleAdmin(forceShow = false) {
        const el = document.getElementById('admin-panel');
        const isHidden = el.classList.contains('hidden');
        if (isHidden || forceShow) {
            el.classList.remove('hidden');
            document.getElementById('admin-cfg').value = JSON.stringify(Engine.config.gachaTable, null, 2);
            // Load stats
            const h = JSON.parse(localStorage.getItem(Data.keyHist)||'[]');
            const sum = h.reduce((a,b)=>a+b.v,0);
            document.getElementById('admin-stats').innerText = `TOTAL OUT: ${sum.toLocaleString()} | PLAYS: ${h.length}`;
        } else {
            el.classList.add('hidden');
        }
    }
};

// BOOTSTRAP
window.onload = () => Engine.init();

</script>
</body>
</html>
