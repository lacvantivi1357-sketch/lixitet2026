<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>L√¨ X√¨ 11.0 - Eternal Legends</title>
    <style>
        :root { --primary: #d32f2f; --gold: #fbc02d; --fever: #00e5ff; --ice: #bbdefb; }
        body {
            margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif;
            background: #121212; touch-action: none; user-select: none;
            transition: filter 0.3s;
        }

        /* Hi·ªáu ·ª©ng Debuff */
        .blur-effect { filter: blur(10px) grayscale(0.5); }
        .ice-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 100; border: 15px solid var(--ice); opacity: 0; transition: 0.3s; box-shadow: inset 0 0 50px var(--ice); }
        
        /* Giao di·ªán ch√≠nh */
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; color: white; }
        #menuScreen { display: flex; background: radial-gradient(circle, #f44336, #b71c1c); }
        #gameScreen { background: #fffdfa; cursor: none; }
        
        .hud { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-around; font-size: 1.5rem; font-weight: 900; color: var(--primary); z-index: 10; text-shadow: 1px 1px white; }
        .status-icons { position: absolute; top: 50px; display: flex; gap: 8px; font-size: 1.2rem; }

        .energy-bar { position: absolute; bottom: 15px; left: 10%; width: 80%; height: 12px; background: rgba(0,0,0,0.1); border-radius: 10px; border: 2px solid var(--primary); overflow: hidden; }
        .energy-fill { width: 0%; height: 100%; background: linear-gradient(90deg, var(--fever), #fff); transition: 0.3s; }

        /* Gacha Cards */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 20px; }
        .card { perspective: 1000px; width: 90px; height: 130px; cursor: pointer; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: 0.6s; transform-style: preserve-3d; }
        .card-f, .card-b { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 12px; display: flex; align-items: center; justify-content: center; border: 2px solid var(--gold); }
        .card-f { background: var(--primary); font-size: 2.5rem; }
        .card-b { background: white; color: var(--primary); font-weight: 800; transform: rotateY(180deg); }
        .flipped .card-inner { transform: rotateY(180deg); }

        .btn { background: var(--gold); color: #7f0000; border: none; padding: 12px 30px; border-radius: 30px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 0 #b79500; margin-top: 15px; }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .admin-trigger { position: fixed; top: 10px; right: 10px; opacity: 0.1; cursor: pointer; z-index: 1000; font-size: 20px; }
        
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 20px; border-radius: 15px; width: 90%; max-width: 380px; color: #333; max-height: 80vh; overflow-y: auto; }
        textarea { width: 100%; padding: 10px; margin: 10px 0; border-radius: 8px; border: 1px solid #ccc; font-family: monospace; }
        
        @keyframes flash { 0% { background: white; } 100% { background: transparent; } }
        .lightning-flash { animation: flash 0.1s; }
    </style>
</head>
<body>

    <div id="iceOverlay" class="ice-overlay"></div>

    <div id="menuScreen" class="screen">
        <div class="admin-trigger" onclick="UI.show('loginModal')">‚öôÔ∏è</div>
        <div style="font-size: 5rem;">üßß</div>
        <h1 style="margin:0; font-size: 2.5rem;">L√å X√å 11.0</h1>
        <p>B·∫£n n√¢ng c·∫•p Tuy·ªát ƒê·ªânh 2026</p>
        <button class="btn" onclick="Game.start()">CH∆†I NGAY</button>
    </div>

    <div id="gameScreen" class="screen">
        <div class="hud">
            <span>‚è≥ <span id="timeVal">60</span>s</span>
            <span>üí∞ <span id="scoreVal">0</span></span>
        </div>
        <div class="status-icons" id="statusIcons"></div>
        <canvas id="gameCanvas"></canvas>
        <div class="energy-bar"><div class="energy-fill" id="energyFill"></div></div>
    </div>

    <div id="pickScreen" class="screen">
        <h2 style="color:var(--gold)">CH·ªåN QU√Ä MAY M·∫ÆN</h2>
        <p>May m·∫Øn t√≠ch l≈©y: +<span id="luckBonus">0</span>%</p>
        <div class="grid" id="cardGrid"></div>
    </div>

    <div id="revealScreen" class="screen">
        <div style="background:white; color:var(--primary); padding:30px; border-radius:25px; border:5px solid var(--gold); width:260px;">
            <h2>CH√öC M·ª™NG!</h2>
            <div id="prizeAmount" style="font-size: 2.5rem; font-weight: 900; margin: 20px 0;">0ƒë</div>
            <button class="btn" onclick="location.reload()">CH∆†I L·∫†I</button>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h3>üîê Admin Login</h3>
            <input type="text" id="admU" placeholder="T√†i kho·∫£n" style="width:100%; padding:10px; margin-bottom:10px;">
            <input type="password" id="admP" placeholder="M·∫≠t kh·∫©u" style="width:100%; padding:10px; margin-bottom:10px;">
            <button class="btn" style="width:100%" onclick="Admin.login()">V√ÄO H·ªÜ TH·ªêNG</button>
            <button class="btn" style="width:100%; background:#eee;" onclick="UI.hide('loginModal')">ƒê√ìNG</button>
        </div>
    </div>

    <div id="adminPanel" class="modal">
        <div class="modal-content">
            <h3 style="margin:0">‚öôÔ∏è C·∫•u H√¨nh</h3>
            <textarea id="cfgData" rows="5"></textarea>
            <button class="btn" style="width:100%" onclick="Admin.save()">L∆ØU T·ª∂ L·ªÜ</button>
            <div id="stats" style="margin:15px 0; font-size: 0.9rem; padding: 10px; background: #f5f5f5; border-radius: 8px;"></div>
            <button class="btn" style="width:100%; background:#f44336; color:white;" onclick="Admin.clear()">X√ìA L·ªäCH S·ª¨</button>
            <button class="btn" style="width:100%; background:#eee;" onclick="UI.hide('adminPanel')">THO√ÅT</button>
        </div>
    </div>

<script>
/* ================= H·ªÜ TH·ªêNG C·ªêT L√ïI ================= */
const Core = {
    cfgKey: 'lx11_cfg', histKey: 'lx11_hist',
    getCfg: () => JSON.parse(localStorage.getItem(Core.cfgKey)) || [
        {a:10000, w:100}, {a:20000, w:45}, {a:50000, w:15}, {a:100000, w:5}
    ],
    saveCfg: (d) => localStorage.setItem(Core.cfgKey, JSON.stringify(d)),
    addHist: (v) => {
        let h = JSON.parse(localStorage.getItem(Core.histKey)) || [];
        h.push({t: new Date().toLocaleTimeString(), v: v});
        localStorage.setItem(Core.histKey, JSON.stringify(h.slice(-50)));
    }
};

/* ================= ƒê·ªòNG C∆† TR√í CH∆†I ================= */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let W, H;

const Game = {
    active: false, score: 0, time: 60, items: [],
    player: { x: 0, w: 90, h: 80 },
    fever: { val: 0, active: false, timer: 0 },
    buffs: { shield: false, frozen: 0, blurred: 0, lightning: 0, magnet: 0 },

    start: () => {
        W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight;
        Game.player.x = W/2 - 45; Game.player.y = H - 120;
        Game.active = true; Game.score = 0; Game.time = 60;
        Game.items = []; Game.fever = { val:0, active:false, timer:0 };
        Game.buffs = { shield: false, frozen: 0, blurred: 0, lightning: 0, magnet: 0 };
        UI.show('gameScreen'); document.getElementById('menuScreen').style.display='none';
        Game.loop(); Game.spawn(); Game.tick();
    },

    tick: () => {
        let timer = setInterval(() => {
            if(!Game.active) return clearInterval(timer);
            Game.time--; document.getElementById('timeVal').innerText = Game.time;
            
            // X·ª≠ l√Ω th·ªùi gian Buff/Debuff
            if(Game.buffs.frozen > 0) {
                Game.buffs.frozen--;
                if(Game.buffs.frozen <= 0) document.getElementById('iceOverlay').style.opacity = 0;
            }
            if(Game.buffs.blurred > 0) {
                Game.buffs.blurred--;
                if(Game.buffs.blurred <= 0) document.body.classList.remove('blur-effect');
            }
            if(Game.buffs.lightning > 0) Game.buffs.lightning--;
            if(Game.buffs.magnet > 0) Game.buffs.magnet--;

            if(Game.fever.active) {
                Game.fever.timer--;
                if(Game.fever.timer <= 0) {
                    Game.fever.active = false;
                    document.getElementById('gameScreen').style.background = "#fffdfa";
                }
            }
            UI.updateBuffs();
            if(Game.time <= 0) Game.end();
        }, 1000);
    },

    spawn: () => {
        if(!Game.active) return;
        let r = Math.random(), type = 'coin';
        
        // T·ª∑ l·ªá xu·∫•t hi·ªán c√¢n b·∫±ng
        if(r < 0.15) type = 'bomb';
        else if(r < 0.28) type = 'star';
        else if(r < 0.31) type = 'ice';      // ‚ùÑÔ∏è 3%
        else if(r < 0.34) type = 'lightning';// ‚ö° 3%
        else if(r < 0.37) type = 'fake';     // ü§° 3%
        else if(r < 0.40) type = 'magnet';   // üß≤ 3%
        else if(r < 0.42) type = 'shield';   // üõ°Ô∏è 2%
        else if(r < 0.44) type = 'time';     // ‚åõ 2%

        if(Game.fever.active) type = Math.random() < 0.3 ? 'star' : 'coin';

        Game.items.push({
            x: Math.random()*(W-60), y: -60, type,
            // ƒê·ªô kh√≥ tƒÉng d·∫ßn theo th·ªùi gian (Balance)
            spd: (3.5 + Math.random()*3) * (1 + (60-Game.time)/120)
        });
        setTimeout(Game.spawn, Game.fever.active ? 150 : 600);
    },

    loop: () => {
        if(!Game.active) return;
        ctx.clearRect(0,0,W,H);
        
        // H√¨nh ·∫£nh nh√¢n v·∫≠t theo tr·∫°ng th√°i
        let pIcon = "üß∫";
        if(Game.fever.active) pIcon = "üòé";
        else if(Game.buffs.frozen > 0) pIcon = "ü•∂";
        else if(Game.buffs.lightning > 0) pIcon = "üòµ‚Äçüí´";
        ctx.font = "80px Arial";
        ctx.fillText(pIcon, Game.player.x, Game.player.y + 70);

        for(let i=Game.items.length-1; i>=0; i--) {
            let it = Game.items[i];
            
            // Logic H√∫t v·∫≠t ph·∫©m (Fever ho·∫∑c Magnet)
            if((Game.fever.active || Game.buffs.magnet > 0) && !['bomb','ice','lightning','fake'].includes(it.type)) {
                it.x += (Game.player.x + 40 - it.x) * 0.15;
                it.y += (Game.player.y + 20 - it.y) * 0.15;
            } else {
                it.y += it.spd;
            }

            ctx.font = "45px Arial";
            ctx.fillText({coin:'üßß', bomb:'üí£', star:'üåü', ice:'‚ùÑÔ∏è', lightning:'‚ö°', fake:'ü§°', shield:'üõ°Ô∏è', time:'‚åõ', magnet:'üß≤'}[it.type], it.x, it.y);

            // Va ch·∫°m
            if(it.y > Game.player.y && it.y < Game.player.y + 80 && it.x > Game.player.x - 30 && it.x < Game.player.x + 80) {
                Game.onCatch(it.type); Game.items.splice(i,1);
            } else if(it.y > H) Game.items.splice(i,1);
        }
        document.getElementById('scoreVal').innerText = Game.score;
        document.getElementById('energyFill').style.width = Game.fever.active ? "100%" : Game.fever.val + "%";
        requestAnimationFrame(Game.loop);
    },

    onCatch: (type) => {
        if(type === 'bomb') {
            if(Game.buffs.shield) { Game.buffs.shield = false; return; }
            Game.score = Math.max(0, Game.score - 5); Game.fever.val = 0; // Tr√∫ng bom m·∫•t Fever
            if(navigator.vibrate) navigator.vibrate(200);
        } else if(type === 'coin') Game.score += 1;
        else if(type === 'star') {
            Game.score += 3;
            if(!Game.fever.active) {
                Game.fever.val += 20; // H·ª©ng 5 sao ƒë·ªÉ k√≠ch ho·∫°t Fever
                if(Game.fever.val >= 100) {
                    Game.fever.active = true; Game.fever.val = 0; Game.fever.timer = 6;
                    document.getElementById('gameScreen').style.background = "#e0f7fa";
                }
            }
        }
        else if(type === 'ice') { Game.buffs.frozen = 4; document.getElementById('iceOverlay').style.opacity = 0.7; }
        else if(type === 'lightning') { Game.buffs.lightning = 5; document.body.classList.add('lightning-flash'); setTimeout(()=>document.body.classList.remove('lightning-flash'),100); }
        else if(type === 'fake') { Game.score = Math.max(0, Game.score - 2); Game.buffs.blurred = 3; document.body.classList.add('blur-effect'); }
        else if(type === 'shield') Game.buffs.shield = true;
        else if(type === 'time') Game.time += 5;
        else if(type === 'magnet') Game.buffs.magnet = 5;
    },

    end: () => { 
        Game.active = false; UI.hide('gameScreen'); UI.show('pickScreen'); 
        document.body.classList.remove('blur-effect'); 
        let luck = Math.min(100, Game.score);
        document.getElementById('luckBonus').innerText = luck;
        Gacha.init(luck);
    }
};

/* ================= QUAY TH∆Ø·ªûNG GACHA ================= */
const Gacha = {
    init: (luck) => {
        const grid = document.getElementById('cardGrid'); grid.innerHTML = '';
        for(let i=0; i<9; i++) {
            let c = document.createElement('div'); c.className = 'card';
            c.innerHTML = `<div class="card-inner"><div class="card-f">üßß</div><div class="card-b">?</div></div>`;
            c.onclick = () => Gacha.pick(c, luck); grid.appendChild(c);
        }
        // Ph√≠m t·∫Øt gian l·∫≠n
        window.onkeydown = (e) => { if(e.key === '9') window.f = 'MAX'; if(e.key === '1') window.f = 'MIN'; };
    },
    pick: (el, luck) => {
        if(el.classList.contains('flipped')) return;
        const cfg = Core.getCfg();
        let prize = 10000;
        
        if(window.f === 'MAX') prize = Math.max(...cfg.map(c=>c.a));
        else if(window.f === 'MIN') prize = Math.min(...cfg.map(c=>c.a));
        else {
            let total = 0;
            // Thu·∫≠t to√°n May m·∫Øn ƒë·ªông: ƒêi·ªÉm c√†ng cao gi·∫£i to c√†ng d·ªÖ ra
            let pool = cfg.map(c => {
                let weight = c.w;
                if(c.a >= 50000) weight *= (1 + luck/25); // Boost gi·∫£i l·ªõn
                else weight *= (1 - luck/200); // Gi·∫£m nh·∫π gi·∫£i nh·ªè
                total += weight; return {a: c.a, fw: total};
            });
            let r = Math.random() * total;
            prize = pool.find(p => r <= p.fw).a;
        }
        
        el.classList.add('flipped'); el.querySelector('.card-b').innerText = (prize/1000) + 'k';
        setTimeout(() => { 
            UI.hide('pickScreen'); UI.show('revealScreen'); 
            document.getElementById('prizeAmount').innerText = prize.toLocaleString() + ' VNƒê'; 
            Core.addHist(prize);
        }, 1000);
    }
};

/* ================= QU·∫¢N TR·ªä & GIAO DI·ªÜN ================= */
const Admin = {
    login: () => {
        const u = document.getElementById('admU').value;
        const p = document.getElementById('admP').value;
        if(u === 'Admin' && p === 'Quoc2007@') {
            UI.hide('loginModal'); Admin.open();
        } else alert('Th√¥ng tin kh√¥ng ch√≠nh x√°c!');
    },
    open: () => {
        UI.show('adminPanel');
        document.getElementById('cfgData').value = Core.getCfg().map(c => `${c.a}:${c.w}`).join('\n');
        let h = JSON.parse(localStorage.getItem(Core.histKey)) || [];
        let sum = h.reduce((s, x) => s + x.v, 0);
        document.getElementById('stats').innerHTML = `L∆∞·ª£t ch∆°i: ${h.length} | T·ªïng chi: <b>${sum.toLocaleString()}ƒë</b>`;
    },
    save: () => {
        try {
            let d = document.getElementById('cfgData').value.trim().split('\n').map(l => {
                let [a, w] = l.split(':'); return {a: parseInt(a), w: parseInt(w)};
            });
            Core.saveCfg(d); alert('L∆∞u th√†nh c√¥ng!');
        } catch(e) { alert('Sai ƒë·ªãnh d·∫°ng c·∫•u h√¨nh!'); }
    },
    clear: () => { if(confirm('B·∫°n mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠?')) { localStorage.removeItem(Core.histKey); Admin.open(); } }
};

const UI = {
    show: (id) => document.getElementById(id).style.display = 'flex',
    hide: (id) => document.getElementById(id).style.display = 'none',
    updateBuffs: () => {
        let h = "";
        if(Game.buffs.shield) h += "üõ°Ô∏è ";
        if(Game.buffs.magnet > 0) h += "üß≤ ";
        if(Game.buffs.frozen > 0) h += "‚ùÑÔ∏è ";
        if(Game.buffs.lightning > 0) h += "‚ö° ";
        if(Game.buffs.blurred > 0) h += "ü§° ";
        document.getElementById('statusIcons').innerText = h;
    }
};

// ƒêi·ªÅu khi·ªÉn (Chu·ªôt & C·∫£m ·ª©ng)
const handleMove = (x) => {
    let moveX = x - 45;
    if(Game.buffs.lightning > 0) moveX = W - x - 45; // ‚ö° ƒê·∫£o ng∆∞·ª£c ƒëi·ªÅu khi·ªÉn
    let speed = Game.buffs.frozen > 0 ? 0.15 : 1; // ‚ùÑÔ∏è Ch·∫≠m ch·∫°p
    Game.player.x += (moveX - Game.player.x) * speed;
};

canvas.addEventListener('mousemove', e => handleMove(e.clientX));
canvas.addEventListener('touchmove', e => { e.preventDefault(); handleMove(e.touches[0].clientX); }, {passive:false});
window.onresize = () => { if(Game.active) Game.start(); };
</script>
</body>
</html>
