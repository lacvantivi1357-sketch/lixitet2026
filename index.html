<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>L√¨ X√¨ 19.0 - Legacy Architect Edition</title>
    <style>
        :root { 
            --primary: #d32f2f; --gold: #fbc02d; --fever: #00e5ff; 
            --ice: #bbdefb; --acid: #aed581; --bg: #fffdfa;
        }
        body { 
            margin: 0; overflow: hidden; font-family: 'Segoe UI', system-ui, sans-serif; 
            background: #000; touch-action: none; user-select: none; transition: 0.5s; 
        }

        /* --- VISUAL EFFECTS --- */
        .fx-blur { filter: blur(12px) grayscale(0.4); transition: 0.6s; }
        .fx-ice { 
            position: fixed; inset: 0; pointer-events: none; z-index: 100; 
            border: 25px solid var(--ice); opacity: 0; transition: 0.5s; 
            box-shadow: inset 0 0 120px var(--ice); 
        }
        .fx-eclipse { background: rgba(0,0,0,0.94) !important; transition: 1s; }
        .fx-acid { animation: acidRain 0.4s infinite; }
        @keyframes acidRain { 0% { background: #fffdfa; } 50% { background: #dcedc8; } }
        @keyframes flash { 0% { background: white; } 100% { background: transparent; } }
        .fx-flash { animation: flash 0.2s forwards; }
        .fx-lag { transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important; }

        /* --- SCREENS --- */
        .screen { 
            position: absolute; inset: 0; display: none; flex-direction: column; 
            align-items: center; justify-content: center; text-align: center; color: white; 
        }
        #menuScreen { display: flex; background: radial-gradient(circle, #ff5252, #b71c1c); z-index: 10; }
        #gameScreen { background: var(--bg); cursor: none; overflow: hidden; }

        /* --- HUD ELEMENTS --- */
        .hud { 
            position: absolute; top: 10px; width: 100%; display: flex; 
            justify-content: space-around; font-size: 1.6rem; font-weight: 900; 
            color: var(--primary); z-index: 20; text-shadow: 1px 1px 0 #fff; 
        }
        .status-tray { 
            position: absolute; top: 55px; display: flex; gap: 8px; 
            font-size: 1.3rem; flex-wrap: wrap; max-width: 85%; justify-content: center; z-index: 20; 
        }
        .energy-container { 
            position: absolute; bottom: 20px; left: 10%; width: 80%; height: 14px; 
            background: rgba(0,0,0,0.1); border-radius: 20px; border: 2px solid var(--primary); 
            overflow: hidden; z-index: 20; 
        }
        .energy-fill { 
            width: 0%; height: 100%; background: linear-gradient(90deg, var(--fever), #fff); 
            transition: width 0.4s ease-out; 
        }

        /* --- GACHA SYSTEM --- */
        .card-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 20px; }
        .card { perspective: 1000px; width: 95px; height: 135px; cursor: pointer; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: 0.8s; transform-style: preserve-3d; }
        .card-face { 
            position: absolute; inset: 0; backface-visibility: hidden; border-radius: 15px; 
            display: flex; align-items: center; justify-content: center; border: 3px solid var(--gold); 
        }
        .card-front { background: var(--primary); font-size: 3rem; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .card-back { background: white; color: var(--primary); font-weight: 900; transform: rotateY(180deg); font-size: 1.2rem; }
        .flipped .card-inner { transform: rotateY(180deg); }

        /* --- UI COMPONENTS --- */
        .btn { 
            background: var(--gold); color: #7f0000; border: none; padding: 15px 45px; 
            border-radius: 50px; font-weight: bold; cursor: pointer; 
            box-shadow: 0 6px 0 #b79500; margin-top: 15px; font-size: 1.2rem; 
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .admin-trigger { position: fixed; top: 10px; right: 10px; opacity: 0.04; cursor: pointer; z-index: 1000; font-size: 24px; }
        
        /* --- ADMIN PANEL --- */
        .modal { 
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); 
            z-index: 2000; align-items: center; justify-content: center; 
        }
        .modal-box { 
            background: white; padding: 25px; border-radius: 20px; width: 92%; 
            max-width: 480px; color: #333; max-height: 90vh; overflow-y: auto; 
        }
        textarea { 
            width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; 
            border: 1px solid #ddd; font-family: 'Courier New', monospace; font-size: 0.9rem; 
        }
        .stat-row { display: flex; justify-content: space-between; padding: 10px; background: #f9f9f9; border-radius: 8px; margin-bottom: 8px; }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    </style>
</head>
<body>
    <div id="iceOverlay" class="fx-ice"></div>
    
    <div id="menuScreen" class="screen">
        <div class="admin-trigger" onclick="UI.show('loginModal')">‚öôÔ∏è</div>
        <div style="font-size: 6rem; animation: float 3s infinite;">üèÆ</div>
        <h1 style="margin:0; font-size: 3rem;">L√å X√å 19.0</h1>
        <p>Ki·∫øn tr√∫c S∆∞ Di s·∫£n - B·∫£n Full Option</p>
        <button class="btn" onclick="Game.start()">CH·∫†Y TR√í CH∆†I</button>
    </div>

    <div id="gameScreen" class="screen">
        <div class="hud">
            <span>‚åõ <span id="timeVal">60</span>s</span>
            <span>üí∞ <span id="scoreVal">0</span></span>
        </div>
        <div class="status-tray" id="statusIcons"></div>
        <canvas id="gameCanvas"></canvas>
        <div class="energy-container"><div class="energy-fill" id="energyFill"></div></div>
    </div>

    <div id="pickScreen" class="screen">
        <h2 style="color:var(--gold); font-size: 2rem;">CH·ªåN V·∫¨N M·ªÜNH C·ª¶A B√â</h2>
        <p>Luck Bonus: +<span id="luckBonus">0</span>%</p>
        <div class="card-grid" id="cardGrid"></div>
    </div>

    <div id="revealScreen" class="screen">
        <div style="background:white; color:var(--primary); padding:40px; border-radius:30px; border:6px solid var(--gold); width:300px; box-shadow: 0 0 50px rgba(255,215,0,0.4);">
            <h2 style="margin:0">K·∫æT QU·∫¢</h2>
            <div style="font-size: 5rem; margin: 15px 0;">üê≤</div>
            <div id="prizeAmount" style="font-size: 3rem; font-weight: 900;">0ƒë</div>
            <button class="btn" onclick="location.reload()">L∆ØU & THO√ÅT</button>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-box">
            <h3 style="text-align:center">üîê X√ÅC TH·ª∞C QU·∫¢N TR·ªä</h3>
            <input type="text" id="admU" placeholder="User" style="width:100%; padding:12px; margin-bottom:12px; border-radius:8px; border:1px solid #ddd;">
            <input type="password" id="admP" placeholder="Password" style="width:100%; padding:12px; margin-bottom:12px; border-radius:8px; border:1px solid #ddd;">
            <button class="btn" style="width:100%" onclick="Admin.login()">ƒêƒÇNG NH·∫¨P</button>
            <button class="btn" style="width:100%; background:#eee; box-shadow:none; color:#666;" onclick="UI.hide('loginModal')">H·ª¶Y</button>
        </div>
    </div>

    <div id="adminPanel" class="modal">
        <div class="modal-box" style="max-width: 500px;">
            <h3 style="margin-top:0; color:var(--primary);">‚öôÔ∏è H·ªÜ TH·ªêNG ƒêI·ªÄU H√ÄNH</h3>
            <div id="statsContent"></div>
            <label><b>T·ª∑ l·ªá (Ti·ªÅn : Tr·ªçng s·ªë):</b></label>
            <textarea id="cfgData" rows="6"></textarea>
            <button class="btn" style="width:100%" onclick="Admin.save()">L∆ØU C·∫§U H√åNH</button>
            <button class="btn" style="width:100%; background:#f44336; color:white;" onclick="Admin.clear()">X√ìA D·ªÆ LI·ªÜU</button>
            <button class="btn" style="width:100%; background:#999; color:white;" onclick="UI.hide('adminPanel')">THO√ÅT</button>
        </div>
    </div>

<script>
/* ================= H·ªÜ TH·ªêNG L∆ØU TR·ªÆ (STORAGE) ================= */
const Sys = {
    cfgKey: 'lx19_cfg', histKey: 'lx19_hist',
    defaultCfg: [{a:10000, w:100}, {a:20000, w:55}, {a:50000, w:12}, {a:100000, w:3}, {a:200000, w:1}],
    get: () => JSON.parse(localStorage.getItem(Sys.cfgKey)) || Sys.defaultCfg,
    save: (d) => localStorage.setItem(Sys.cfgKey, JSON.stringify(d)),
    log: (v) => { 
        let h = JSON.parse(localStorage.getItem(Sys.histKey)) || []; 
        h.push({t: new Date().toLocaleTimeString(), v}); 
        localStorage.setItem(Sys.histKey, JSON.stringify(h.slice(-100))); 
    }
};

/* ================= ƒê·ªòNG C∆† √ÇM THANH (AUDIO SYNTH) ================= */
const AudioEngine = {
    ctx: null,
    init() { if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
    play(freq, type = 'sine', dur = 0.1) {
        if(!this.ctx) return;
        const o = this.ctx.createOscillator(), g = this.ctx.createGain();
        o.type = type; o.frequency.setValueAtTime(freq, this.ctx.currentTime);
        g.gain.setValueAtTime(0.1, this.ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + dur);
        o.connect(g); g.connect(this.ctx.destination);
        o.start(); o.stop(this.ctx.currentTime + dur);
    },
    success() { this.play(880); this.play(1100, 'sine', 0.2); },
    fail() { this.play(120, 'sawtooth', 0.4); },
    fever() { this.play(440, 'square', 0.3); setTimeout(()=>this.play(660, 'square', 0.5), 100); }
};

/* ================= ENGINE TR√í CH∆†I CH√çNH ================= */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let W, H;

const Game = {
    active: false, score: 0, time: 60, items: [], particles: [],
    player: { x: 0, y: 0, w: 95, h: 85, armor: 0, luckBonus: 0 },
    fever: { val: 0, active: false, timer: 0 },
    // Tr·∫°ng th√°i Buff/Debuff (30 lo·∫°i th·ª±c th·ªÉ)
    states: { shield: false, frozen: 0, blur: 0, reverse: 0, magnet: 0, ghost: 0, eclipse: 0, fog: 0, speed: 0, giant: 0, slow: 0, stun: 0, acid: 0, lag: 0, mini: 0, double: 0, god: 0, drain: 0, tornado: 0, hole: 0 },

    start: () => {
        AudioEngine.init();
        W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight;
        Game.player.x = W/2 - 47; Game.player.y = H - 130;
        Game.active = true; Game.score = 0; Game.time = 60; Game.items = []; Game.particles = [];
        Game.fever = { val:0, active:false, timer:0 };
        Object.keys(Game.states).forEach(k => Game.states[k] = (typeof Game.states[k] === 'boolean' ? false : 0));
        Game.player.armor = 0; Game.player.luckBonus = 0;
        UI.show('gameScreen'); document.getElementById('menuScreen').style.display='none';
        Game.loop(); Game.spawn(); Game.tick();
    },

    tick: () => {
        let clock = setInterval(() => {
            if(!Game.active) return clearInterval(clock);
            Game.time--; document.getElementById('timeVal').innerText = Game.time;
            
            Object.keys(Game.states).forEach(k => { if(typeof Game.states[k] === 'number' && Game.states[k] > 0) Game.states[k]--; });
            
            // Logic tr·ª´ ƒëi·ªÉm c√¢n b·∫±ng (Economy Drain)
            if(Game.states.acid > 0 || Game.states.drain > 0) Game.score = Math.max(0, Game.score - 1.5);
            
            if(Game.fever.active) { 
                Game.fever.timer--; 
                if(Game.fever.timer <= 0) Game.fever.active = false; 
            }
            
            UI.updateFX();
            if(Game.time <= 0) Game.end();
        }, 1000);
    },

    spawn: () => {
        if(!Game.active) return;
        let r = Math.random(), type = 'coin';
        
        // PH√ÇN B·ªî V·∫¨T PH·∫®M (Balancing 80/20)
        if(r < 0.10) type = 'bomb';
        else if(r < 0.18) type = 'star';
        else if(r < 0.20) type = 'ice'; else if(r < 0.22) type = 'reverse'; else if(r < 0.24) type = 'fake';
        else if(r < 0.25) type = 'stun'; else if(r < 0.26) type = 'lag'; else if(r < 0.27) type = 'acid';
        else if(r < 0.28) type = 'hole'; else if(r < 0.29) type = 'tornado'; else if(r < 0.30) type = 'poison';
        else if(r < 0.32) type = 'shield'; else if(r < 0.34) type = 'magnet'; else if(r < 0.36) type = 'god';
        else if(r < 0.38) type = 'double'; else if(r < 0.40) type = 'armor'; else if(r < 0.41) type = 'dragon';
        else if(r < 0.42) type = 'diamond';

        if(Game.fever.active) type = (Math.random() < 0.4) ? 'star' : 'coin';

        Game.items.push({ 
            x: Math.random()*(W-60), y: -60, type, 
            spd: (3.8 + Math.random()*3) * (1 + (60-Game.time)/140), 
            phase: Math.random()*Math.PI*2 
        });
        
        let rate = Game.fever.active ? 150 : Math.max(300, 800 - (60-Game.time)*7);
        setTimeout(Game.spawn, rate);
    },

    loop: () => {
        if(!Game.active) return;
        ctx.clearRect(0,0,W,H);
        
        // V·∫Ω Particles (Particle Engine)
        Game.particles.forEach((p, idx) => {
            p.x += p.vx; p.y += p.vy; p.life -= 0.025;
            if(p.life <= 0) Game.particles.splice(idx, 1);
            else {
                ctx.fillStyle = `rgba(255, 215, 0, ${p.life})`;
                ctx.fillRect(p.x, p.y, 4, 4);
            }
        });

        let pSize = Game.player.w * (Game.states.giant > 0 ? 1.8 : (Game.states.mini > 0 ? 0.6 : 1));
        let pIcon = Game.fever.active ? "üòé" : (Game.states.frozen > 0 ? "ü•∂" : (Game.states.stun > 0 ? "üòµ" : (Game.states.god > 0 ? "üéã" : "üß∫")));
        
        // V·∫Ω Nh√¢n v·∫≠t (Basket)
        ctx.save();
        if(Game.states.ghost > 0) ctx.globalAlpha = 0.2;
        ctx.font = `${pSize}px Arial`;
        ctx.fillText(pIcon, Game.player.x, H-60);
        if(Game.player.armor > 0) { ctx.font="25px Arial"; ctx.fillText("üõ°Ô∏èx"+Game.player.armor, Game.player.x, H-150); }
        ctx.restore();

        // X·ª≠ l√Ω v·∫≠t ph·∫©m
        for(let i=Game.items.length-1; i>=0; i--) {
            let it = Game.items[i];
            let isBad = ['bomb','ice','reverse','fake','stun','lag','acid','hole','tornado','poison'].includes(it.type);
            
            // Logic H·ªë ƒêen (Physics)
            if(it.type === 'hole') {
                it.y += it.spd;
                Game.items.forEach(o => { 
                    if(o !== it) {
                        let d = Math.hypot(it.x - o.x, it.y - o.y);
                        if(d < 160) { o.x += (it.x - o.x)*0.14; o.y += (it.y - o.y)*0.14; }
                    }
                });
            } else if((Game.fever.active || Game.states.magnet > 0) && !isBad) {
                it.x += (Game.player.x + pSize/2 - it.x) * 0.16; it.y += (H - 100 - it.y) * 0.16;
            } else {
                it.y += Game.states.slow > 0 ? it.spd * 0.4 : it.spd;
                if(Game.states.fog > 0) it.x += Math.sin(it.phase + it.y/25) * 7;
            }

            ctx.font = `45px Arial`;
            let iconMap = {coin:'üßß', bomb:'üí£', star:'üåü', ice:'‚ùÑÔ∏è', reverse:'‚ö°', fake:'ü§°', shield:'üõ°Ô∏è', magnet:'üß≤', dragon:'üêâ', diamond:'üíé', god:'üéã', double:'üßßX2', armor:'ü•ü', ghost:'üëª', eclipse:'üåë', fog:'üå´Ô∏è', stun:'üîí', lag:'üèπ', acid:'üåßÔ∏è', hole:'üï≥Ô∏è', tornado:'üå™Ô∏è', poison:'üçÑ'};
            ctx.fillText(iconMap[it.type] || 'üßß', it.x, it.y);

            if(it.y > H-130 && it.y < H-50 && it.x > Game.player.x-40 && it.x < Game.player.x + pSize) {
                Game.onCatch(it.type, it.x, it.y); Game.items.splice(i,1);
            } else if(it.y > H) Game.items.splice(i,1);
        }

        document.getElementById('scoreVal').innerText = Math.floor(Game.score);
        document.getElementById('energyFill').style.width = Game.fever.active ? "100%" : Game.fever.val + "%";
        requestAnimationFrame(Game.loop);
    },

    onCatch: (type, x, y) => {
        let isBad = ['bomb','ice','reverse','fake','stun','lag','acid','hole','tornado','poison'].includes(type);
        if(isBad && (Game.states.god > 0)) return;
        if(isBad && Game.player.armor > 0) { Game.player.armor--; AudioEngine.fail(); return; }
        if(isBad && Game.states.shield) { Game.states.shield = false; AudioEngine.fail(); return; }
        
        let p = {coin:1, star:5, dragon:100, diamond:50}[type] || 0;
        Game.score += p * (Game.states.double > 0 ? 2 : 1);

        if(type === 'bomb') { 
            Game.score = Math.max(0, Game.score - 10); 
            Game.fever.val = Math.max(0, Game.fever.val - 35); // C√¢n b·∫±ng: Ch·ªâ tr·ª´ Fever, ko reset s·∫°ch
            AudioEngine.fail();
        } else if(type === 'star') {
            if(!Game.fever.active) {
                Game.fever.val += 20;
                if(Game.fever.val >= 100) { Game.fever.active = true; Game.fever.val = 0; Game.fever.timer = 8; AudioEngine.fever(); }
            }
            AudioEngine.success();
        } else if(type === 'ice') Game.states.frozen = 4;
        else if(type === 'reverse') Game.states.reverse = 6;
        else if(type === 'fake') { Game.score = Math.max(0, Game.score - 5); Game.states.blur = 4; }
        else if(type === 'stun') Game.states.stun = 2;
        else if(type === 'shield') Game.states.shield = true;
        else if(type === 'armor') Game.player.armor = 3;
        else if(type === 'magnet') Game.states.magnet = 6;
        else if(type === 'god') Game.states.god = 6;

        // B√πng n·ªï h·∫°t (Particle Blast)
        for(let i=0; i<12; i++) Game.particles.push({ x, y, vx: Math.random()*8-4, vy: Math.random()*8-4, life: 1 });
        if(navigator.vibrate) navigator.vibrate(60);
    },

    end: () => { 
        Game.active = false; UI.hide('gameScreen'); UI.show('pickScreen'); 
        document.body.className=""; 
        // LUCK BALANCING: Max luck 50% cho kinh t·∫ø b·ªÅn v·ªØng
        let luck = Math.min(50, Game.score/5); 
        document.getElementById('luckBonus').innerText = Math.floor(luck);
        Gacha.init(luck);
    }
};

/* ================= H·ªÜ TH·ªêNG GACHA B·ªêC THƒÇM ================= */
const Gacha = {
    init: (luck) => {
        const grid = document.getElementById('cardGrid'); grid.innerHTML = '';
        for(let i=0; i<9; i++) { 
            let c = document.createElement('div'); c.className='card'; 
            c.innerHTML=`<div class="card-inner"><div class="card-face card-front">üßß</div><div class="card-face card-back">?</div></div>`; 
            c.onclick=()=>Gacha.pick(c, luck); grid.appendChild(c); 
        }
        // GIAN L·∫¨N ADMIN
        window.onkeydown = (e) => { if(e.key==='9') window.cheat='MAX'; if(e.key==='1') window.cheat='MIN'; };
    },
    pick: (el, luck) => {
        if(el.classList.contains('flipped')) return;
        const cfg = Sys.get(); let prize = 10000;
        
        if(window.cheat === 'MAX') prize = Math.max(...cfg.map(c=>c.a));
        else if(window.cheat === 'MIN') prize = Math.min(...cfg.map(c=>c.a));
        else {
            let total = 0;
            // THU·∫¨T TO√ÅN KINH T·∫æ (Floor protection)
            let pool = cfg.map(c => { 
                let weight = c.w; 
                if(c.a >= 50000) weight *= (1 + luck/12); 
                else weight = Math.max(weight * 0.35, weight * (1 - luck/100)); // Lu√¥n gi·ªØ 35% x√°c su·∫•t gi·∫£i nh·ªè
                total += weight; return {a: c.a, fw: total}; 
            });
            let r = Math.random() * total; prize = pool.find(p => r <= p.fw).a;
        }
        
        el.classList.add('flipped'); el.querySelector('.card-back').innerText = (prize/1000)+'k';
        setTimeout(() => { 
            UI.hide('pickScreen'); UI.show('revealScreen'); 
            document.getElementById('prizeAmount').innerText = prize.toLocaleString()+'ƒë'; 
            Sys.log(prize); 
        }, 1200);
    }
};

/* ================= QU·∫¢N TR·ªä VI√äN & UI ================= */
const Admin = {
    login: () => { 
        if(document.getElementById('admU').value==='Admin' && document.getElementById('admP').value==='Quoc2007@') { 
            UI.hide('loginModal'); Admin.open(); 
        } else alert('X√°c th·ª±c th·∫•t b·∫°i!'); 
    },
    open: () => {
        UI.show('adminPanel'); document.getElementById('cfgData').value = Sys.get().map(c=>`${c.a}:${c.w}`).join('\n');
        let h = JSON.parse(localStorage.getItem(Sys.histKey)) || [];
        let sum = h.reduce((s, x) => s + x.v, 0);
        document.getElementById('statsContent').innerHTML = `
            <div class="stat-row"><span>T·ªïng chi:</span><b>${sum.toLocaleString()}ƒë</b></div>
            <div class="stat-row"><span>L∆∞·ª£t ch∆°i:</span><b>${h.length}</b></div>
        `;
    },
    save: () => { 
        try { 
            let d = document.getElementById('cfgData').value.trim().split('\n').map(l=>{
                let [a,w]=l.split(':'); return {a:parseInt(a), w:parseInt(w)}
            }); 
            Sys.save(d); alert('ƒê√£ l∆∞u c·∫•u h√¨nh!'); 
        } catch(e){ alert('L·ªói ƒë·ªãnh d·∫°ng!'); } 
    },
    clear: () => { if(confirm('X√≥a s·∫°ch l·ªãch s·ª≠?')) { localStorage.removeItem(Sys.histKey); Admin.open(); } }
};

const UI = {
    show: (id) => document.getElementById(id).style.display = 'flex',
    hide: (id) => document.getElementById(id).style.display = 'none',
    updateFX: () => {
        document.body.classList.toggle('fx-blur', Game.states.blur > 0);
        document.getElementById('iceOverlay').style.opacity = Game.states.frozen > 0 ? 0.8 : 0;
        document.getElementById('gameScreen').classList.toggle('fx-eclipse', Game.states.eclipse > 0);
        document.getElementById('gameScreen').classList.toggle('fx-fever', Game.fever.active);
        document.getElementById('gameCanvas').classList.toggle('fx-lag', Game.states.lag > 0);
        
        let h = ""; 
        if(Game.states.god>0) h+="üéã"; if(Game.states.double>0) h+="üßßX2"; if(Game.states.shield) h+="üõ°Ô∏è"; 
        if(Game.states.magnet>0) h+="üß≤"; if(Game.states.reverse>0) h+="‚ö°";
        document.getElementById('statusIcons').innerText = h;
    }
};

const handleMove = (x) => {
    if(Game.states.stun > 0) return;
    let moveX = x - 47;
    if(Game.states.reverse > 0) moveX = W - x - 47; // ƒê·∫£o chi·ªÅu ‚ö°
    let speed = (Game.states.frozen > 0 ? 0.12 : 1) * (Game.states.speed > 0 ? 1.8 : 1);
    Game.player.x += (moveX - Game.player.x) * (Game.states.lag > 0 ? 0.05 : speed);
};

canvas.addEventListener('mousemove', e => handleMove(e.clientX));
canvas.addEventListener('touchmove', e => { e.preventDefault(); handleMove(e.touches[0].clientX); }, {passive:false});
window.onresize = () => { if(Game.active) Game.start(); };
</script>
</body>
</html>
